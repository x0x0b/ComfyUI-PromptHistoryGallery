# ComfyUI-PromptHistoryGallery

## Project Overview
**ComfyUI-PromptHistoryGallery** is a custom node extension for [ComfyUI](https://github.com/comfyanonymous/ComfyUI). It enhances the user experience by capturing prompts and generated images, offering a history dialog, popup previews, and a comprehensive gallery viewer.

### Key Features
- **Prompt History Input Node:** Captures prompts while passing `CONDITIONING` to the workflow.
- **History Dialog:** View, search, and manage recent prompts (copy, delete, send to node).
- **Gallery Viewer:** Visual browser for history and generated images.
- **Popup Previews:** Instant visual feedback upon generation completion.
- **Persistence:** Stores history in a SQLite database (`prompt_history_gallery/data/prompt_history.db`).

## Project Structure
- `prompt_history_gallery/`: Python backend source code.
    - `nodes/`: Contains the implementation of the custom nodes (e.g., `Prompt History Input`).
    - `data/`: Default location for the SQLite database.
    - `models.py`, `storage.py`, etc.: Core logic for data handling.
- `web/`: Frontend source code (JavaScript, CSS).
    - `history_dialog.js`: Logic for the history UI.
    - `lib/`: Helper modules for bridging with ComfyUI and managing the DOM.
    - `vendor/`: Third-party libraries (e.g., Viewer.js).
- `scripts/`: Utility scripts (e.g., formatting).
- `.github/workflows/`: CI/CD configurations.

## Development & Conventions

### Environment
This project is a ComfyUI extension and relies on the ComfyUI runtime environment.
- **Python:** >= 3.10
- **Node.js:** Required for frontend formatting checks (Prettier).

### formatting & Linting
The project enforces strict formatting for both Python and Web files.

**One-Shot Formatting Script:**
Use the provided script to automatically format all files:
```bash
./scripts/format.sh
```
*Requires `pipx` and `npm`/`npx` to be installed.*

**Manual Commands:**

*   **Python (Ruff):**
    ```bash
    # Check formatting
    ruff format --check .
    
    # Check import sorting
    ruff check --select I .
    
    # Apply fixes
    ruff format .
    ruff check --select I --fix .
    ```

*   **Web (Prettier):**
    ```bash
    # Check formatting
    npx prettier@3.7.4 --check "web/**/*.{js,jsx,ts,tsx,css,scss,html,json}"
    
    # Apply fixes
    npx prettier@3.7.4 -w "web/**/*.{js,jsx,ts,tsx,css,scss,html,json}"
    ```

### Testing & CI
The project uses GitHub Actions (`.github/workflows/ci.yml`) to enforce code quality on push and pull requests to `main`.
- **Ruff:** Verifies Python formatting and import order.
- **Prettier:** Verifies frontend code formatting.

### Build & Release
- No complex build step is required for local development; ComfyUI loads the extension directly.
- Release bundles are automatically generated by GitHub Actions.
